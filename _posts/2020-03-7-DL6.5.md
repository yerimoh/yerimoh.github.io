---
title: "[06.5] Deep learning 1: ë¯¸êµ­ ìˆ˜í™” ë°ì´í„°ì„¸íŠ¸ ì´ë¯¸ì§€ ë¶„ë¥˜ TEST"
date:   2020-03-7
excerpt: "ë¯¸êµ­ ìˆ˜í™” ë°ì´í„°ì„¸íŠ¸ ì´ë¯¸ì§€ ë¶„ë¥˜ ì •ë§ ì§ì ‘ êµ¬í˜„í•´ë³´ê¸°"
category: [Deep Learning]
layout: post
tag:
- Deep Learning
order: 0

comments: true
---

# ë¯¸êµ­ ìˆ˜í™” ë°ì´í„°ì„¸íŠ¸ ì´ë¯¸ì§€ ë¶„ë¥˜

## ì‹œì‘í•˜ê¸° ì „ ë°°ìš¸ ê°œë…
* [MNIST ì—°ìŠµí•˜ëŸ¬ ê°€ê¸°]( https://yerimoh.github.io/DL6/)      
â¡ ì•„ë˜ì˜ ë¬¸ì œì™€ ê±°ì˜ ìœ ì‚¬í•˜ë‹ˆ ìœ„ì˜ ê°œë…ì„ ì™„ì „íˆ ìˆ™ì§€í•˜ê³  ì˜¤ì    


## ëª©í‘œ
* íŠ¸ë ˆì´ë‹ì„ ìœ„í•œ ì´ë¯¸ì§€ ë°ì´í„° ì¤€ë¹„     
* ì´ë¯¸ì§€ ë¶„ë¥˜ë¥¼ ìœ„í•œ ë‹¨ìˆœ ëª¨ë¸ ìƒì„± ë° ì»´íŒŒì¼     
* ì´ë¯¸ì§€ ë¶„ë¥˜ ëª¨ë¸ íŠ¸ë ˆì´ë‹ ë° ê²°ê³¼ ê´€ì°°      

## ë¯¸êµ­ ìˆ˜í™” ë°ì´í„°ì…‹ ì„¤ëª…
* 26ê°œì˜ ë¬¸ìê°€ í¬í•¨        
* ì´ ì¤‘ ë‘ ê°œì˜ ë¬¸ì(j ë° z)ì—ëŠ” ë™ì‘ì´ ìš”êµ¬ë˜ë¯€ë¡œ ì œì™¸      

![image](https://user-images.githubusercontent.com/76824611/128883527-6e6b2705-f0b4-45fb-9e3d-25b6727055ff.png)


----



# ë°ì´í„° ë¡œë“œ   
MNISTì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ Kerasë¥¼ í†µí•´ ì œê³µë˜ì§€ ì•ŠìŒ     
â¡ x_train, y_train, x_valid , y_valid ë¥¼ ë¶€ë¥´ê¸° ìœ„í•œ ë‹¤ë¥¸ ë°©ë²• í•„ìš”       

## ë°ì´í„° ì½ê¸°
ìˆ˜í™” ë°ì´í„°ì„¸íŠ¸ëŠ” csv í˜•ì‹ìœ¼ë¡œ ë˜ì–´ìˆìŒ.      
* ìƒë‹¨ì— ë ˆì´ë¸”ì´ ìˆëŠ” í–‰ê³¼ ì—´ë¡œ ì´ë£¨ì–´ì§„ ê·¸ë¦¬ë“œ       
* ë°ì´í„°ë¥¼ ë¡œë“œí•˜ì—¬ ì‘ì—…í•˜ê¸° ìœ„í•´ ë°ì´í„° ë¡œë“œ ë° ì¡°ì‘ì„ ìœ„í•œ ê³ ì„±ëŠ¥ íˆ´ì¸ [Pandas](https://yerimoh.github.io/PD/)ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©           
* CSV íŒŒì¼ì€ [DataFrame]( https://yerimoh.github.io/PD2/#%EB%8D%B0%EC%9D%B4%ED%84%B0%ED%94%84%EB%A0%88%EC%9E%84-%EB%8B%A4%EB%A3%A8%EA%B8%B0)ì´ë¼ëŠ” í˜•ì‹ìœ¼ë¡œ ì½ìŒ        
 
```python
import pandas as pd
```


Pandasì—ëŠ” csv íŒŒì¼ì„ ì˜ˆìƒí•˜ê³  DataFrameì„ ë°˜í™˜í•˜ëŠ” read_csv ë©”ì„œë“œê°€ ì¡´ì¬      
* ì´ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ ì˜¬ ê²ƒì„   

```python
train_df = pd.read_csv("data/asl_data/sign_mnist_train.csv")
valid_df = pd.read_csv("data/asl_data/sign_mnist_valid.csv")
```

### ë°ì´í„° ì‚´í´ë³´ê¸°
* head ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ DataFrameì˜ ì²˜ìŒ í–‰ ëª‡ ê°œë¥¼ ì¶œë ¥   
* 784ê°œì˜ ê°’ì„ ì§€ë‹Œ ì´ë¯¸ì§€      

```python
train_df.head()
```
![image](https://user-images.githubusercontent.com/76824611/128883791-44d36ec4-47da-439c-91f5-0a482b1328a2.png)


### ë ˆì´ë¸” ì¶”ì¶œ
íŠ¸ë ˆì´ë‹ ë° ê²€ì¦ ë ˆì´ë¸”ì„ y_train ë° y_valid ë³€ìˆ˜ì— ì €ì¥í•˜ëŠ” ë²•    
1ï¸âƒ£ í•´ë‹¹ ë³€ìˆ˜ë¥¼ ìƒì„±         
2ï¸âƒ£ ë‹¤ìŒ ë ˆì´ë¸”ì´ ë” ì´ìƒ í•„ìš”ì—†ëŠ” ë°ì´í„°í”„ë ˆì„ ì›ë³¸ì—ì„œ ë ˆì´ë¸”ì„ ì‚­ì œ      

```python
# label ì´ë¼ëŠ” ì—´ì´ ì •ë‹µì—´ì„
y_train = train_df['label'] 
y_valid = valid_df['label']
del train_df['label']
del valid_df['label']
```
### ì´ë¯¸ì§€ ì¶”ì¶œ
íŠ¸ë ˆì´ë‹ ë° ê²€ì¦ ì´ë¯¸ì§€ë¥¼ x_train ë° x_valid ë³€ìˆ˜ì— ì €ì¥      
```python
x_train = train_df.values
x_valid = valid_df.values
```
### íŠ¸ë ˆì´ë‹ ë° ê²€ì¦ ë°ì´í„° ìš”ì•½
**[íŠ¸ë ˆì´ë‹]**       
* x_train.shape: íŠ¸ë ˆì´ë‹ì„ ìœ„í•œ ê°ê° 784ê°œ í”½ì…€ì„ í¬í•¨í•˜ëŠ” 27,455ê°œì˜ ì´ë¯¸ì§€ ì¡´ì¬     
* y_train.shape: íŠ¸ë ˆì´ë‹ì„ ìœ„í•œ ìœ„ ì´ë¯¸ì§€ì˜ ë ˆì´ë¸”(ì •ë‹µ)   
   
```python 
x_train.shape
# (27455, 784)
# (ì´ë¯¸ì§€ ê°œìˆ˜, ê° í”½ì…€ ê°œìˆ˜)
y_train.shape
# (27455,)

# (ìœ„ ì´ë¯¸ì§€ì˜ ì •ë‹µ ê°œìˆ˜,)
```


**[ê²€ì¦]**      
* x_valid.shape :ê²€ì¦ì„ ìœ„í•œ 7,172ê°œì˜ ì´ë¯¸ì§€, 784ê°œì˜ í”½ì…€ ì¡´ì¬     
* y_valid.shape: ê²€ì¦ì„ ìœ„í•œ ì´ë¯¸ì§€ì˜ ì •ë‹µ  
  
```python
x_valid.shape
# (7172, 784)
# (ì´ë¯¸ì§€ ê°œìˆ˜, í”½ì…€ê°œìˆ˜)
y_valid.shape
# (7172,)
# ì´ë¯¸ì§€ ì •ë‹µê°œìˆ˜
```


## ë°ì´í„° ì‹œê°í™”
* [matplotlib]( https://yerimoh.github.io//PD3/#matplotlib-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC%EB%A1%9C-%EA%B7%B8%EB%9E%98%ED%94%84-%EA%B7%B8%EB%A6%AC%EA%B8%B0) ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©      
* ì´ë¯¸ì§€ë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ 784ê°œ í”½ì…€ë¡œ ì´ë£¨ì–´ì§„ **1D ëª¨ì–‘ â¡  28x28í”½ì…€ë¡œ ì´ë£¨ì–´ì§„ 2D ëª¨ì–‘**     
```python
import matplotlib.pyplot as plt
plt.figure(figsize=(40,40))

num_images = 20
for i in range(num_images):
    row = x_train[i]
    label = y_train[i]
    
    image = row.reshape(28,28)
    plt.subplot(1, num_images, i+1)
    plt.title(label, fontdict={'fontsize': 30})
    plt.axis('off')
    plt.imshow(image, cmap='gray')
```


--

# TEST
##  ì´ë¯¸ì§€ë°ì´í„° ì •ê·œí™”  
ë°ì´í„°ì˜ í”½ì…€ ê°’ì´ í˜„ì¬ì²˜ëŸ¼ 0~255ê°€ ì•„ë‹Œ 0~1ì˜ ë¶€ë™ ì†Œìˆ˜ì  ê°’ì´ ë˜ì–´ì•¼í•¨        
* [ì´ìœ  ì•Œì•„ë³´ëŸ¬ê°€ê¸°]( https://yerimoh.github.io/DL6/#2-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%95%EA%B7%9C%ED%99%94)

ë³´ê¸°ì „ì— ì½”ë“œ ì§ì ‘ ì³ë³´ê³  ì •ë§ ì •ë‹µ í™•ì¸ìš©ìœ¼ë¡œ ë´ë¼   
<details>
<summary>ğŸ‘€ ì •ë‹µ ì½”ë“œ ë³´ê¸°</summary>
<div markdown="1">

```python
x_train = x_train / 255
x_valid = x_valid / 255
```

</div>
</details>


## ë ˆì´ë¸” ë¶„ë¥˜
* [ë ˆì´ë¸”ì„ ë²”ì£¼ ì¸ì½”ë”©]( https://yerimoh.github.io/DL6/#31-%EB%B2%94%EC%A3%BC-%EC%9D%B8%EC%BD%94%EB%94%A9)

* ```keras.utils.to_categorical``` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ê¸°ì— ì¸ì½”ë”©í•  ê°’ê³¼ ê°’ì„ ì¸ì½”ë”©í•  ë²”ì£¼ ìˆ˜ë¥¼ ì „ë‹¬í•´ ë²”ì£¼ ì¸ì½”ë”©     
* ```kerasë¥¼ ê°€ì ¸ì™€ ë²”ì£¼ ìˆ˜(24)ë¥¼ ì„¤ì •í•´ë‘ ```       

```python
import tensorflow.keras as keras
num_classes = 24
```

ì´ ë‹¤ìŒ ì½”ë“œë¥¼ ì§œë´ë¼     
* Categorically encode y_train and y_valid     

<details>
<summary>ğŸ‘€ ì •ë‹µ ì½”ë“œ ë³´ê¸°</summary>
<div markdown="1">

```python
# TODO: Categorically encode y_train and y_valid.
y_train = keras.utils.to_categorical(y_train, num_classes)
y_valid = keras.utils.to_categorical(y_valid, num_classes)
```
    
</div>
</details>




## ëª¨ë¸ ë¶„ë¥˜
ë°ì´í„°ê°€ ëª¨ë‘ ì¤€ë¹„ë˜ì—ˆìŒ ì´ì œ ìˆœì°¨ëª¨ë¸ êµ¬ì¶•í•  ì°¨ë¡€

ë‹¤ìŒê³¼ ê°™ì€ ëª¨ë¸ì„ êµ¬ì¶•í•´ë´ë¼    

1ï¸âƒ£ ì…ë ¥ ë ˆì´ì–´: dense, 512ê°œì˜ ë‰´ëŸ° í¬í•¨, í™œì„±í™” í•¨ìˆ˜ relu ì‚¬ìš©, ì…ë ¥ì´ë¯¸ì§€ ëª¨ì–‘(784,)        
2ï¸âƒ£ 512ê°œì˜ ë‰´ëŸ° í¬í•¨, í™œì„±í™” í•¨ìˆ˜ reluì‚¬ìš©, ë°€ì§‘ ë ˆì´ì–´ ì§€ë‹˜       
3ï¸âƒ£ ë‰´ëŸ° ìˆ˜ = í´ë˜ìŠ¤, í™œì„±í™” í•¨ìˆ˜ softmax, ë°€ì§‘ ì¶œë ¥ ë ˆì´ì–´ ì§€ë‹˜     
â• ëª¨ë¸ì„ ì €ì¥í•  model ë³€ìˆ˜ë¥¼ ìƒì„±      


* Keras ìˆœì°¨ ëª¨ë¸ í´ë˜ìŠ¤ì™€ Dense ë ˆì´ì–´ í´ë˜ìŠ¤ë¥¼ ê°€ì ¸ì˜´

```python
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Dense
```
<details>
<summary> ğŸ‘€ ì •ë‹µ ì½”ë“œ ë³´ê¸°</summary>
<div markdown="1">

```python
models =  Sequential() # ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
model.add(Dense(units = 512, activation='relu', input_shape=(784,))) #1ï¸âƒ£ 
model.add(Dense(units = 512, activation='relu')) #2ï¸âƒ£ 
model.add(Dense(units = num_classes, activation='softmax')) #3ï¸âƒ£ 
```

</div>
</details>


## ëª¨ë¸ ìš”ì•½

<details>
<summary> ğŸ‘€ ì •ë‹µ ì½”ë“œ ë³´ê¸°</summary>
<div markdown="1">

```python
model.summary()
```

</div>
</details>


## ëª¨ë¸ ì»´íŒŒì¼
ì‹¤ì œë¡œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë¸ì„ íŠ¸ë ˆì´ë‹í•˜ê¸° ì „ì— ìˆ˜í–‰í•´ì•¼ í•  ë§ˆì§€ë§‰ ë‹¨ê³„       
* ì†ì‹¤í•¨ìˆ˜: ```categorical crossentropy```ì‚¬ìš©      
* ëª¨ë¸ì˜ ì •í™•ë„ë¥¼ ì¸¡ì •

<details>
<summary> ğŸ‘€ ì •ë‹µ ì½”ë“œ ë³´ê¸°</summary>
<div markdown="1">

```python
model.compile(loss='categorical_crossentropy', metrics=['accuracy'])
```

</div>
</details>



## ëª¨ë¸ íŠ¸ë ˆì´ë‹
ëª¨ë¸ì˜ ```fit``` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìœ„ì—ì„œ ìƒì„±í•œ íŠ¸ë ˆì´ë‹ ë° ê²€ì¦ ì´ë¯¸ì§€ì™€ ë ˆì´ë¸”ë¡œ **20ì—í¬í¬** ë™ì•ˆ íŠ¸ë ˆì´ë‹í•´ë¼.     


<details>
<summary> ğŸ‘€ ì •ë‹µ ì½”ë“œ ë³´ê¸°</summary>
<div markdown="1">

```python
model.fit(x_train, y_train, epochs=20, verbose=1, validation_data=(x_valid, y_valid))
```

</div>
</details>


## ê²°ê³¼ í•´ì„

ë¨¼ì € ê²°ê³¼ë¥¼ ë³´ì

```python
Epoch 1/20
858/858 [==============================] - 2s 3ms/step - loss: 1.9609 - accuracy: 0.3805 - val_loss: 1.4943 - val_accuracy: 0.5194
Epoch 2/20
858/858 [==============================] - 2s 3ms/step - loss: 0.9549 - accuracy: 0.6765 - val_loss: 1.0257 - val_accuracy: 0.6767
Epoch 3/20
858/858 [==============================] - 2s 3ms/step - loss: 0.5751 - accuracy: 0.8078 - val_loss: 1.6662 - val_accuracy: 0.5782
Epoch 4/20
858/858 [==============================] - 2s 3ms/step - loss: 0.3964 - accuracy: 0.8738 - val_loss: 0.8707 - val_accuracy: 0.7769
Epoch 5/20
858/858 [==============================] - 2s 3ms/step - loss: 0.3031 - accuracy: 0.9107 - val_loss: 1.8709 - val_accuracy: 0.6090
Epoch 6/20
858/858 [==============================] - 2s 3ms/step - loss: 0.2558 - accuracy: 0.9319 - val_loss: 1.0081 - val_accuracy: 0.7864
Epoch 7/20
858/858 [==============================] - 2s 3ms/step - loss: 0.2183 - accuracy: 0.9418 - val_loss: 2.5155 - val_accuracy: 0.6352
Epoch 8/20
858/858 [==============================] - 2s 3ms/step - loss: 0.2059 - accuracy: 0.9524 - val_loss: 1.5742 - val_accuracy: 0.7352
Epoch 9/20
858/858 [==============================] - 2s 3ms/step - loss: 0.1746 - accuracy: 0.9594 - val_loss: 0.9821 - val_accuracy: 0.8316
Epoch 10/20
858/858 [==============================] - 2s 3ms/step - loss: 0.1803 - accuracy: 0.9654 - val_loss: 1.2241 - val_accuracy: 0.8228
Epoch 11/20
858/858 [==============================] - 2s 3ms/step - loss: 0.1793 - accuracy: 0.9632 - val_loss: 1.4079 - val_accuracy: 0.8049
Epoch 12/20
858/858 [==============================] - 2s 3ms/step - loss: 0.1732 - accuracy: 0.9649 - val_loss: 1.3251 - val_accuracy: 0.8377
Epoch 13/20
858/858 [==============================] - 2s 3ms/step - loss: 0.1434 - accuracy: 0.9703 - val_loss: 1.8805 - val_accuracy: 0.7966
Epoch 14/20
858/858 [==============================] - 2s 3ms/step - loss: 0.1503 - accuracy: 0.9705 - val_loss: 1.3894 - val_accuracy: 0.8381
Epoch 15/20
858/858 [==============================] - 2s 3ms/step - loss: 0.1442 - accuracy: 0.9728 - val_loss: 1.8816 - val_accuracy: 0.7705
Epoch 16/20
858/858 [==============================] - 2s 3ms/step - loss: 0.1488 - accuracy: 0.9747 - val_loss: 2.1172 - val_accuracy: 0.7724
Epoch 17/20
858/858 [==============================] - 2s 3ms/step - loss: 0.1410 - accuracy: 0.9766 - val_loss: 1.3971 - val_accuracy: 0.8404
Epoch 18/20
858/858 [==============================] - 2s 3ms/step - loss: 0.1620 - accuracy: 0.9748 - val_loss: 3.0549 - val_accuracy: 0.7453
Epoch 19/20
858/858 [==============================] - 2s 3ms/step - loss: 0.1318 - accuracy: 0.9781 - val_loss: 1.8434 - val_accuracy: 0.8310
Epoch 20/20
858/858 [==============================] - 2s 3ms/step - loss: 0.1211 - accuracy: 0.9812 - val_loss: 1.7680 - val_accuracy: 0.8434
<tensorflow.python.keras.callbacks.History at 0x7fb84e4138d0>
```

íŠ¸ë ˆì´ë‹ ì •í™•ë„ëŠ” **[ë†’/ë‚®]**ê³  í…ŒìŠ¤íŠ¸ ì •í™•ë„ê°€ **[ë†’/ë‚®]** ë‹¤.     
ì´ìœ ëŠ” **(             )** ì´ê¸° ë•Œë¬¸ì´ë‹¤      


<details>
<summary> ğŸ‘€ ì •ë‹µ ë³´ê¸°</summary>
<div markdown="1">

íŠ¸ë ˆì´ë‹ ì •í™•ë„ëŠ” ë†’ê³  í…ŒìŠ¤íŠ¸ ì •í™•ë„ê°€ ë‚®ë‹¤.     
ì´ìœ ëŠ” [overfiting](https://yerimoh.github.io/DL5/#%EC%98%A4%EB%B2%84%ED%94%BC%ED%8C%85)ì´ê¸° ë•Œë¬¸ì´ë‹¤      

</div>
</details>


## ë©”ëª¨ë¦¬
ë„˜ì–´ê°€ê¸° ì „ì— ë‹¤ìŒ ì…€ì„ ì‹¤í–‰í•˜ì—¬ GPU ë©”ëª¨ë¦¬ë¥¼ ì§€ìš°ê¸°     
ì´ëŠ” ë‹¤ìŒ ë…¸íŠ¸ë¶ìœ¼ë¡œ ë„˜ì–´ê°€ê¸° ìœ„í•œ í•„ìˆ˜ ì‘ì—…     
```python
import IPython
app = IPython.Application.instance()
app.kernel.do_shutdown(True)
```
